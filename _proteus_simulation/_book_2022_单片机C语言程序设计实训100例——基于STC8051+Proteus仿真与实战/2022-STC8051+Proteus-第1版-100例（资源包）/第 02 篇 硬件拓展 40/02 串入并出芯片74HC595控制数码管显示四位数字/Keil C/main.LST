C51 COMPILER V9.54   MAIN                                                                  02/23/2022 21:14:30 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND TABS(2)

line level    source

   1          //-----------------------------------------------------------------
   2          //  名称：74HC595串入并出芯片控制数码管显示四位数字
   3          //-----------------------------------------------------------------
   4          //  说明：4片74HC595串入并出芯片控制四位数码管循环显示指定的四组数据.
   5          //
   6          //-----------------------------------------------------------------
   7          #include "STC15xxx.h"
   8          #include <intrins.h>
   9          #define u8  unsigned char
  10          #define u16 unsigned int
  11          sbit SH_CP  = P1^0;       //移位时钟脉冲
  12          sbit DS   = P1^1;       //串行数据输入
  13          sbit ST_CP  = P1^2;       //输出锁存器控制脉冲
  14          code u8 SEG_CODE[] = {        //共阳数码管段码表
  15           0xC0,0xF9,0xA4,0xB0,0x99,0x92,0x82,0xF8,0x80,0x90};
  16          u16 myData[4] = {2938,1234,1509,3506};  //待显示数据
  17          //-----------------------------------------------------------------
  18          // 延时函数(1ms, xms, x取值1~65535)
  19          //-----------------------------------------------------------------
  20          void Delay1ms() { //@12.000MHz
  21   1        u8 i = 12, j = 169;
  22   1        do {
  23   2          while (--j);
  24   2        } while (--i);
  25   1      }
  26          //-----------------------------------------------------------------
  27          void delay_ms(u16 x) { while(x--) Delay1ms(); }
  28          //-----------------------------------------------------------------
  29          // 1字节数据串行输入595子程序
  30          //-----------------------------------------------------------------
  31          void Serial_Input_595(u8 d) {
  32   1        u8 i;
  33   1        for(i = 0; i < 8; i++) {
  34   2          d <<= 1; DS = CY;     //移出高位到CY,然后写数据线
  35   2          SH_CP = 0; _nop_();_nop_(); //时钟线输出低电平
  36   2          SH_CP = 1; _nop_();_nop_(); //时钟线上升沿移位
  37   2        }
  38   1        SH_CP = 0;            //移位时钟线最后置为低电平
  39   1      }
  40          //-----------------------------------------------------------------
  41          // 595并行输出子程序
  42          //-----------------------------------------------------------------
  43          void Parallel_Output_595() {
  44   1        ST_CP = 0; _nop_();_nop_();   //先置低电平
  45   1        ST_CP = 1; _nop_();_nop_();   //上升沿将数据送到输出锁存器
  46   1        SH_CP = 0; _nop_();_nop_();   //置低电平
  47   1      }
  48          //-----------------------------------------------------------------
  49          //主程序
  50          //-----------------------------------------------------------------
  51          void main() {
  52   1        u8 i,t;
  53   1        P1M1 = 0x00; P1M0 = 0x00;   //配置为准双向口
  54   1        while (1) {
  55   2          for( i = 0; i < 4; i++ ){ //四组数据输出
C51 COMPILER V9.54   MAIN                                                                  02/23/2022 21:14:30 PAGE 2   

  56   3            //分解出每组数据中的0~3位,串行输出到595
  57   3            t = SEG_CODE[myData[i] % 10];       //第0位
  58   3            Serial_Input_595(t);            //串行输入595
  59   3            //以下这一位附加小数点
  60   3            t = SEG_CODE[myData[i] / 10 % 10] & 0x7F; //第1位
  61   3            Serial_Input_595(t);            //串行输入595
  62   3            t = SEG_CODE[myData[i] % 1000/100];   //第2位
  63   3            Serial_Input_595(t);            //串行输入595
  64   3            t = SEG_CODE[myData[i] / 1000];       //第3位
  65   3            Serial_Input_595(t);            //串行输入595
  66   3            //4片595同时并行输出到数码管显示
  67   3            Parallel_Output_595();            //整体并行输出
  68   3            delay_ms(800);
  69   3          }
  70   2        }
  71   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    233    ----
   CONSTANT SIZE    =     10    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      8    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
