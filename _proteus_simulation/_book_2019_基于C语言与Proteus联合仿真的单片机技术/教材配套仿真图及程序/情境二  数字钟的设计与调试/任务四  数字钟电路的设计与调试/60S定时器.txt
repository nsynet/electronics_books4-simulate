//===========声明区======================================================================================
#include <reg51.h>
#define shuma P2            //定义数码管数码端接P2口
#define xuanze P3            //定义数码管控制端接P3口
char code tab[]={0xc0,0xf9,0xa4,0xb0,0x99,0x92,0x82,0xf8,0x80,0x98};   //0~9的共阳极驱动码
saomiao( );                  //声明扫描函数
delay(int);                   //声明延时函数
int sec20=0;                 //定义50ms的次数初始值为0
int sec=0;                   //定义秒初始值为0
//==========================主函数======================================================================
main( )
{
  TH0=(65536-50000)/256;       //定时器设初始值
  TL0=(65536-50000)%256;
  TMOD=0x01;                              // 设置定时器0的工作方式为1
  EA=1;                                    // 开中断总开关
  ET0=1;                                   // 开定时器0中断开关
  TR0=1;                                   // 启动定时器0                   
  while(1)
	{	
	saomiao( );                      // 调用扫描函数
	}
}
//========扫描函数=====================================================================
saomiao( )
{
xuanze=0xbf;                         // 选择分十位
    shuma=tab[sec/10];                   //  显示分十位数字
    delay(2);
xuanze=0x7f;                         // 选择小时十位
    shuma=tab[sec%10];                   // 显示分个位数字
    delay(2);
  }
//=============================定时器0中断子程序=========================================
void onesec(void) interrupt 1   
  {   TH0=(65536-50000)/256;	           // 重新加载初始值
TL0=(65536-50000)%256;		  
	sec20++;				 //  每50ms加1
	if(sec20==20)				 //  计到20次，即1秒
		{
		 sec++;				 //  秒加1
		 sec20=0;				 //  sec20清0
		 }
	if(sec==60)			      // 如果60秒时间到
		{
		sec=0;			      // 秒数清0
	   }
       }
//==========================1ms延时子程序==================================================
delay(int x)
{   int i,j;
for(i=0;i<x;i++)
for(j=0;j<120;j++);
}