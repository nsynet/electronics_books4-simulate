#include<reg51.h>
#define out P2
sbit button1=P3^7;	   // 正转按钮
sbit button2=P3^6;	   // 转按钮
sbit jia=P3^5;	         // 加速按钮
//步进电机的加减速程序
sbit jian=P3^4;	         // 减速按钮
chushihua();		       // 初始化子程序
delay(int);
int k=3;			   // 表格里的第几个数据，初始化后，应该是到了第4个数据，所以K的初始修值设为3。
int shijian=20;		        // 延时时间参数，单位是ms					   
char code tab[]={0x0c,0x06,0x03,0x09};		 //电机运行脉冲数据 
//=========主程序=======================================================================================
main()
{
	chushihua( );	 
	while(1)
	{
	 	if(button1==0)  k++;		      // 正转时，数据往右取
	    if(button2==0)  k--;		  // 反转时，数据往左取
		if(k==4) k=0;			      // 处理
		if(k==-1) k=3;			      // 处理
		out=tab[k];				      / / 送给电机，运行
		delay(shijian);				  // 延时
		if(jia==0)  shijian=shijian-10;
		if(jian==0)  shijian=shijian+10;
		if(shijian<20)     shijian=20;
		if(shijian>20000)  shijian=20000;
	}
}
//=====================步进电机初始化子程序===========================================================
chushihua( )						 //初始化子程序，因为电机一开始不知在什么角度，给脉冲时，一开始肯定会晃
{					      //所以在控制之前加上初始化程序，给4步后电机肯定会停在第4步的那个位置
	out=tab[0];					 // 接下来主程序再控制电机时，就不会出现晃的现象了。
	delay(100);					 // 实际电机，可能这个时间要调
	out=tab[1];
	delay(100);
	out=tab[2];
	delay(100);
	out=tab[3];
	delay(100);
}
//==========延迟函数===================================================================================  
delay(int x)
{ int i,j;
for(i=0;i<x;i++)
for(j=0;j<120;j++);
}